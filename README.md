# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```
## Данные и типы данных, используемые в приложении
Карточка товара:
```typescript
interface ICard {
    id: string;
    description: string;
    image: string;
    title: string;
    category: string;
    price: number | null;
    buttonDisable(state: boolean): void;
}
```

Данные для совершения покупки:
```typescript
interface IOrder{
    payment: string;
    address: string;
    email: string;
    phone: string;
    total: number;
    items: string[];
}
```

Категории товаров:
```typescript
type TCategory =
	| 'софт-скил'
	| 'другое'
	| 'дополнительное'
	| 'кнопка'
	| 'хард-скил';
```

Выбор способа оплаты:
```typescript
interface IPaymentChange {
    method: string;
}
```


## Архитектура приложения

Код приложения разделен на слои согласно парадигме MVP: 
- слой представления, отвечает за отображение данных на странице, 
- слой данных, отвечает за хранение и изменение данных
- презентер, отвечает за связь представления и данных.

### Базовый код

#### Класс `Api`
Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.
Методы: 
- `get` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

#### Класс `EventEmitter`
Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.  
Основные методы, реализуемые классом описаны интерфейсом `IEvents`:
- `on` - подписка на событие
- `emit` - инициализация события
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие   

#### Класс `Component<T>`
Абстрактный базовый класс, предназначенным для создания компонентов пользовательского интерфейса. Класс обеспечивает инструментарий для управления DOM элементами и поведением компонента. Наследуется всеми классами представления(View)

`constructor(container: HTMLElement)` - принимает элемент контейнера, в который будет помещен компонент\

Методы:
- `toggleClass` - переключает класс
- `setText` - устанавливает текстовое содержимое
- `setDisabled` - изменяет статус блокировки
- `setHidden` - скрывает элемент
- `setVisible` - показывает элемент
- `setImage` - устанавливает изображения с алтернативным текстом
- `render` - возвращает корневой DOM-элемент

#### Класс `Model<T>`
Базовый класс, расширяющий класс Component, предназначен для работы с данными, используется для представления и для работы с данными.
`constructor(data:Partial<T>, events: IEvents)` - конструктор, на вход принимает исходные данные для модели и объект событий для сообщения об изменениях модели.

Методы: 
- полностью наследуются от класса Component<T>
- `emitChanges` - сообщает всем об изменении модели

### Общие классы

#### Класс `Form`

Класс `Form` - класс для работы с формами.\
Наследуется от класса `Component` и расширяет его функциональность.\
`constructor(container: HTMLFormElement, events: IEvents)` - DOM элемент для кнопки отправки формы и отображения ошибок\

Поля:
- _submit - кнопка сабмита формы,
- _errors - контейнер вывода ошибок валидации.

Методы:
- handleSubmit - обработка события ввода,
- set valid - контроль активности кнопки отправки формы в зависимости от правильности заполнения формы,
- set errors - отображение списка ошибок валидации,
- render - отображение состояние формы
- onInputChange - обработчик изменений в полях ввода и обновление состояния формы,
- clearForm - очистка формы заполнения и ошибок,
- buttonDisable - состояние кнопки.

#### Класс `Modal`

Класс `Modal` - класс для работы с модальными окнами.\
Наследуется от класса `Component` и расширяет его функциональность.\
`constructor(container: HTMLElement, events: IEvents)` - DOM элемент для кнопки закрыти и контента модального окна \

Поля:
- _closeButton - кнопка закрытия модального окна,
- _content - содержимое модального окна.

Методы:
- set content - устанавливает содержимое модального окна,
- open - открытие модального окна,
- close - закрытие модального окна,
- render - отображение модального окна.

### Классы для работы с отображением

#### Класс `Card`

Класс `Card` - класс для работы с карточкой товара на главной странице, в модальном окне и в корзине. Наследуется от класса `Component` и расширяет его функциональность.\
`constructor(container: HTMLElement, actions?: IActions)` - DOM элемент карточки и её действия \

Поля:
- _id - id товара,
- _image - изображение товара,
- _title - название товара,
- _category - категория товара,
- _price - цена товара.

Методы:
- clickHandler - установка слушателя,
- set image - установка значения свойства image объекта,
- set title - установка заголовка карточки,
- set category - установка категории карточки товара,
- set price - установка цены товара.

##### Класс `CardPreview`

Класс `CardPreview` - класс для работы с отображением карточкой товара. Расширяет класс `Card`.\
`constructor(container: HTMLElement, actions?: IActions)` - DOM элемент карточки и её действия \

Поля:
- _description - описание товара,
- _button - кнопка дабваления товара в корзину.

Методы:
- set description - установка описания товара,
- set button - установка текста на кнопке добавления товара,
- buttonDisable - переключение состояния активности кнопки,
- clickHandler - установка слушателя на кнопку добавления товара.

#### Класс `Basket`

Класс `Basket` - класс для работы с корзиной. Наследуется от класса `Component` и расширяет его функциональность.\
`constructor(container: HTMLElement, actions?:IActions)` - DOM элемент карточки и её действия \

Поля:
- _list - список товаров в корзине,
- _total - общая стоимость заказа в корзине,
- _button - кнопка оформления заказа в корзине.

Методы:
- set items - установка значения содержимого в корзине,
- set total - установка общей стоимости покупки,
- buttonDisable - состояние активности кнопки.

#### Класс `BasketItem`

Класс `BasketItem` - класс для работы с карточкой товара в корзине. Наследуется от класса `Component` и расширяет его функциональность.\
`constructor(container: HTMLElement, actions?:IActions)` - DOM элемент карточки и её действия \

Поля:
- _index - порядковый номер товара в корзине,
- _title - название товара,
- _price - цена товара,
- _deleteButton - кнопка удаления товара из корзины.

Методы:
- set index - установка порядкового номера,
- set title - установка названия товара,
- set price - установка цены товара.


#### Класс `Page`

Класс `Page` - класс оотбражения и управления всеми элементами на главной странице. Наследуется от класса `Component` и расширяет его функциональность.\
`constructor(container: HTMLElement, events: IEvents)` - DOM элемент главной страницы и брокер событий \

Поля:
- _counter - счётчик товаров на значке "корзина",
- _catalog - каталог (масив) товаров,
- _wrapper - контейнер для отображения товаров из каталога,
- _basket - корзина покупателя.


Методы:
- set counter - установка счётчика,
- set catalog - установка содержимого каталога товаров,
- set locked - установка обёртки.

#### Класс `OrderForm`

Класс `OrderForm` - реализует форму выбора способа оплаты и ввода адреса доставки товара. Наследуется от класса `Form` и расширяет его функциональность.\
`constructor(container: HTMLElement, events: EventEmitter)` - DOM элемент формы оформления покупки и брокер событий \

Поля:
- _paymentCard - кнопка оплаты картой,
- _paymentCash - кнопка оплаты при получении,
- _inputAdress - поле ввода адресса доставки товара.

Методы:
- setAddEventListeners - слушатель кнопок выбора оплаты и ввода адреса доставки,
- handleMethodCard - выбор оплаты карточкой,
- handleMethodCash - выбор оплаты наличными,
- handleAddressInput - ввод адреса доставки,
- handlePayment - переключение активности кнопок выбора способа оплаты,
- updateButtonState - обновление состояния кнопки при условии ввода(выбора) данных,
- clearForm - очистка формы оформления заказа.

#### Класс `ContactForm`

Класс `ContactForm` - класс для работы с формой контактов. Наследуется от класса `Form` и расширяет его функциональность.\
`constructor(container: HTMLElement, events: IEvents)` - DOM элемент формы контакты и брокер событий \

Поля:
- _email - поле ввода почты,
- _phone - поле ввода номера телефона.

Методы:
- setAddEventListeners - слушатель полей ввода на форме,
- updateButtonState - состояние активности кнопки на форме,
- handleEmailInput - ввод электронной почты,
- handlePhoneInput - ввод номера телефона,
- handleSubmit - событие отправки формы.

#### Класс `Success`

Класс `Success` - класс для работы с успешной покупкой. Наследуется от класса `Component` и расширяет его функциональность.\
`constructor(container: HTMLElement, events: IEvents)` - DOM элемент формы успешной покупки и брокер событий \

Поля:
- title - название товара,
- _description - описавние товара,
- buttonClose - кнопка закрытия успешной покупки.

Методы:
- set description - меняет содержимое элемента с суммой покупки,
- handleSuccessSubmit - событие закрытия окна покупки.

### Слой коммуникации

#### Класс LarekAPI
Принимает в конструктор экземпляр класса Api и предоставляет методы реализующие взаимодействие с бэкендом сервиса.

## Взаимодействие компонентов
Код, описывающий взаимодействие представления и данных между собой находится в файле `index.ts`, выполняющем роль презентера.\
Взаимодействие осуществляется за счет событий генерируемых с помощью брокера событий и обработчиков этих событий, описанных в `index.ts`\
В `index.ts` сначала создаются экземпляры всех необходимых классов, а затем настраивается обработка событий.

*Список всех событий, которые могут генерироваться в системе:*\
*События изменения данных (генерируются классами моделями данных)*
- `items:change` - изменение списка товаров,
- `formErrors:change` - изменение в списке ошибок валидации формы.

*События, возникающие при взаимодействии пользователя с интерфейсом (генерируются классами, отвечающими за представление)*
- `card:select` - выбор карточки для отображения в модальном окне
- `card:add` - добавление товара в корзину,
- `card:remove` - удаление товара из корзины,
- `basket:open` - открытие окна корзины,
- `order:open` - открытие формы order,
- `card:remove` - изменение товаров в корзине,
- `paymentCard:changed` - изменение способа оплаты на card,
- `paymentCash:changed` - изменение способа оплаты на cash,
- `order:submit` - сабмит формы order,
- `contact:submit` - сабмит формы contact,
- `success:close` - закрытие окна успешной покупки,
- `modal:open` - открытие модального окна,
- `modal:close` - закрытие модального окна.